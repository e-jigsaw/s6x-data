{"id":"5db30842e8c640001748c1f1","title":"React Hooks の useReducer と向き合う","image":null,"created":1572014148,"updated":1572014593,"lines":[{"id":"5db30842e8c640001748c1f1","text":"React Hooks の useReducer と向き合う","created":1572014148,"updated":1572014161},{"id":"5db3084e4ade4d0000ccefcf","text":"\t`useState` で誤魔化していたのだけど、使ってみたら案外便利かも？とおもってちょっと素振りした","created":1572014161,"updated":1572014186},{"id":"5db3087f4ade4d0000ccefd5","text":"\t仕事で [Apollo] を使っていて便利なのだけど、別件では未だに REST なので、Apollo っぽいインターフェースで REST を叩けることを目標にする","created":1572014207,"updated":1572014250},{"id":"5db308c34ade4d0000ccefed","text":"\t","created":1572014276,"updated":1572014276},{"id":"5db3086a4ade4d0000ccefd3","text":"\tcode:index.tsx","created":1572014187,"updated":1572014198},{"id":"5db308764ade4d0000ccefd4","text":"\t enum DATA_FETCH_ACTION {","created":1572014198,"updated":1572014309},{"id":"5db308e54ade4d0000cceff3","text":"    FETCH_COMPLETE = 'FETCH_COMPLETE'","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceff4","text":"  }","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceff5","text":"  ","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceff6","text":"  interface DataFetchState<T> {","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceff7","text":"    loading: boolean","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceff8","text":"    error: Maybe<Error>","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceff9","text":"    data: Maybe<T>","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceffa","text":"  }","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceffb","text":"  ","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceffc","text":"  interface DataFetchAction<T> {","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceffd","text":"    type: DATA_FETCH_ACTION","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000cceffe","text":"    payload: T","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000ccefff","text":"    error?: boolean","created":1572014309,"updated":1572014309},{"id":"5db308e54ade4d0000ccf000","text":"  }","created":1572014309,"updated":1572014309},{"id":"5db309024ade4d0000ccf003","text":"  ","created":1572014342,"updated":1572014342},{"id":"5db309024ade4d0000ccf004","text":"  const dataFetchReducer = <T>(","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf005","text":"    state: DataFetchState<T>,","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf006","text":"    action: DataFetchAction<T>","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf007","text":"  ): DataFetchState<T> => {","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf008","text":"    switch (action.type) {","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf009","text":"      case DATA_FETCH_ACTION.FETCH_COMPLETE: {","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf00a","text":"        return {","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf00b","text":"          ...state,","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf00c","text":"          loading: false,","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf00d","text":"          data: action.payload","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf00e","text":"        }","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf00f","text":"      }","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf010","text":"    }","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf011","text":"    return state","created":1572014342,"updated":1572014342},{"id":"5db309034ade4d0000ccf012","text":"  }","created":1572014342,"updated":1572014342},{"id":"5db308e34ade4d0000cceff1","text":"\t ","created":1572014307,"updated":1572014308},{"id":"5db308e34ade4d0000cceff2","text":"\t const useRequest = <T>(url: string) => {","created":1572014308,"updated":1572014308},{"id":"5db308b14ade4d0000ccefd6","text":"    const [state, dispatch] = useReducer<","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefd7","text":"      React.Reducer<DataFetchState<T>, DataFetchAction<T>>","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefd8","text":"    >(dataFetchReducer, {","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefd9","text":"      loading: true,","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefda","text":"      error: null,","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefdb","text":"      data: null","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefdc","text":"    })","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefdd","text":"    useEffect(() => {","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefde","text":"      fetch(url)","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefdf","text":"        .then(res => res.json())","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefe0","text":"        .then(json => {","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefe1","text":"          if (json.data) {","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefe2","text":"            dispatch({","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefe3","text":"              type: DATA_FETCH_ACTION.FETCH_COMPLETE,","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefe4","text":"              payload: json.data as T","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefe5","text":"            })","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefe6","text":"          } else {","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefe7","text":"            // TODO","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefe8","text":"          }","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefe9","text":"        })","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefea","text":"    }, [])","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefeb","text":"    return state","created":1572014257,"updated":1572014257},{"id":"5db308b14ade4d0000ccefec","text":"  }","created":1572014257,"updated":1572014257},{"id":"5db3084e4ade4d0000ccefd0","text":"\tざっくり共通リクエスト部分","created":1572014161,"updated":1572014319},{"id":"5db308ec4ade4d0000ccf002","text":"\t","created":1572014316,"updated":1572014316},{"id":"5db308d04ade4d0000ccefef","text":"\tcode:index.tsx","created":1572014288,"updated":1572014292},{"id":"5db308d44ade4d0000cceff0","text":"\t export const useFoo = ({ id }: Params) {","created":1572014293,"updated":1572014406},{"id":"5db309464ade4d0000ccf013","text":"\t   const state = useRequest<FooResponse>(`/api/foo/${id}`)","created":1572014406,"updated":1572014445},{"id":"5db3096f4ade4d0000ccf015","text":"\t   return state","created":1572014449,"updated":1572014449},{"id":"5db309464ade4d0000ccf014","text":"\t }","created":1572014407,"updated":1572014407},{"id":"5db308c74ade4d0000ccefee","text":"","created":1572014280,"updated":1572014280},{"id":"5db309784ade4d0000ccf016","text":"\tこんな感じで hook を用意しておくと、コンポーネント側から Apollo ライクに呼び出してハンドリングしてあげるだけでアプリケーションが組み立てられて便利","created":1572014456,"updated":1572014488},{"id":"5db309b84ade4d0000ccf018","text":"\tまだエラーハンドリングとかはやってないのでおいおいということで...","created":1572014521,"updated":1572014533},{"id":"5db309784ade4d0000ccf017","text":"","created":1572014456,"updated":1572014456},{"id":"5db309f64ade4d0000ccf01a","text":"#react #javascript #typescript #hooks","created":1572014582,"updated":1572014593},{"id":"5db3084e4ade4d0000ccefd1","text":"#20191025 #1025","created":1572014161,"updated":1572014161},{"id":"5db3084f4ade4d0000ccefd2","text":"","created":1572014161,"updated":1572014161}]}