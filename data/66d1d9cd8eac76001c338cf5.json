{"id":"66d1d9cd8eac76001c338cf5","title":"hono on Cloudflare Pages で Auth.js + Resend で passless 認証","image":null,"created":1725028814,"updated":1725028817,"lines":[{"id":"66d1d9cd8eac76001c338cf5","text":"hono on Cloudflare Pages で Auth.js + Resend で passless 認証","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdf2","text":"from [20240828] #0828","created":1725028814,"updated":1725028817},{"id":"66d1d9cd4ade4d000043bdf3","text":"[hono] on [Cloudflare Pages] で [Auth.js] + [Resend] で passless 認証","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdf4","text":"\t元 [next-auth] こと Auth.js はちょっと使ったことあって、[Cloudflare Workers] には [D1] があるので、これをストアとして素直にセッション張れるんじゃ？ということで","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdf5","text":"\tありがたいことに hono には Auth.js の middleware があって https://www.npmjs.com/package/@hono/auth-js サンプル通りに書いてやって、`providers` に `Resend` の provider を追加して、`adapter` には `DrizzleAdapter` を指定した([drizzle] に慣れているので)","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdf6","text":"\t\tdrizzle のスキーマ定義は https://authjs.dev/getting-started/adapters/drizzle に書いてある通りの内容でスキーマを定義してやって、migrate すればよい","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdf7","text":"\tこんな感じでセットアップして `/api/auth/signin` にアクセスすると、メアドをいれるだけの input と button があるので入力すると Resend からメールが送られてくるので、メールのリンクにアクセスすると callback が飛んでアカウントの作成まで通った","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdf8","text":"\t\t環境変数に Resend の API Key をいれておくのを忘れない","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdf9","text":"\t\tところで、Resend のことはじめて知ったんだけど便利そうな気配を感じる","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdfa","text":"\t今どき [OAuth] の実装とかも面倒だなって気持ちがあり、かといって ID/Pass 認証ってのももうダルいのでいわゆる Magic Link 的なので認証するのが手っ取り早いかな〜と","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdfb","text":"\t\t少し前は [Supabase] を認証に使っていたが、Supabase を採用するとじゃあ DB も Supabase にするかあ、みたいなことになり、いろいろダルくなっていくので [Cloudflare] スタックでまとまるようにした","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdfc","text":"\t\t\tCloudflare にこの手の IdP? の仕組みがあるといいんだけど、[Cloudflare Access] があるだけでこいつはそういう用途には使えなそうなので断念...","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdfd","text":"\t\t\t何気に Resend の部分も Cloudflare の [SES] みたいなのがあるとラクそうだけどなあ...","created":1725028814,"updated":1725028814},{"id":"66d1d9cd4ade4d000043bdfe","text":"","created":1725028814,"updated":1725028814}]}