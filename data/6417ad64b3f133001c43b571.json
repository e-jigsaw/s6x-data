{"id":"6417ad64b3f133001c43b571","title":"Supabase の RLS ハマりポイントやっと解決","image":"https://gyazo.com/9abaef2e344808feaa2b168aba332743/raw","created":1679273316,"updated":1679273321,"lines":[{"id":"6417ad64b3f133001c43b571","text":"Supabase の RLS ハマりポイントやっと解決","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed7b","text":"from [20230319] #0319","created":1679273316,"updated":1679273321},{"id":"6417ad644ade4d0000efed7c","text":"[Supabase] の [RLS] ハマりポイントやっと解決","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed7d","text":"\t冬の LaunchWeek で [pg_crdt] が紹介されてから、[yjs] と Supabase Realtime のつなぎこみを思い出しては試行錯誤していた","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed7e","text":"\tせっかくなので RLS(Row Level Security) を有効にしたいよねってことで試してた","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed7f","text":"\t\tプロジェクトがあって、メンバーがいて、ページがいて...みたいな DB スキーマで、RLS のサンプルでも多対多の中間テーブルを作成して、RLS の `USING` 句の中で中間テーブルと `auth.uid()` を突き合わせて認証状態を検証する....ということにトライしてたんだが、サンプル相当の [SQL] を書いても406が返ってきて困った","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed80","text":"\t\tここで完全に盲点だったのは、この中間テーブル自体の RLS の状態で、ページの RLS 単体をいじってても中間テーブルの RLS が有効になっていて、ポリシーがない状態(これがデフォルトになっちゃうのでハマっていた)だとページの RLS で中間テーブルの RLS が突合できなくてダメだったっぽい","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed81","text":"\t\t\tよくよーくドキュメントを読むと","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed82","text":"\t\t\t\t>Note: If RLS is also enabled for members, the user must also have read (select) access to members. Otherwise the joined query will not yield any results.","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed83","text":"\t\t\t\tて書いてあって膝を打った","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed84","text":"\t[https://gyazo.com/9abaef2e344808feaa2b168aba332743]","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed85","text":"\tなんかキャレットの追従があやしかったり、日本語を入力する時に確定前のワードが投入されてたりいささか怪しい部分はあるけど Supabase をバックエンドに Realtime で複数クライアントで共同編集できるモノが動いた","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed86","text":"\t[Prosemirror] ベースの [TipTap] に Collaboration ext をカマして動かしている","created":1679273316,"updated":1679273316},{"id":"6417ad644ade4d0000efed87","text":"","created":1679273316,"updated":1679273316}]}