{"id":"5d5541c61928f700177d2698","title":"useImperativeHandle と forwardRef を使うととても便利","image":null,"created":1565868489,"updated":1566373950,"lines":[{"id":"5d5541c61928f700177d2698","text":"useImperativeHandle と forwardRef を使うととても便利","created":1565868489,"updated":1565868506},{"id":"5d5541da4ade4d00000b3051","text":"\thooks 出てきた頃に「使うのはコーナーケースなので〜」というようなことが書いてあったのでスルーしていたのだけど、ついに使うタイミングがきた","created":1565868507,"updated":1565939812},{"id":"5d56583d4ade4d00000b3059","text":"\t素直に [React] のアプリ書いてるとユースケースは確かになさそうなのだけど","created":1565939774,"updated":1565940334},{"id":"5d565a6e4ade4d00000b305b","text":"\t\tモーダルで使う機能を hook に切り出している","created":1565940334,"updated":1565940345},{"id":"5d565a784ade4d00000b305c","text":"\t\tモーダルの開け閉めをする関数をモーダルのコンポーネントが持っている","created":1565940345,"updated":1565940345},{"id":"5d565a7c4ade4d00000b305d","text":"\t\t親ページでモーダルの開け閉めをするために子の開け閉め関数を呼びたい","created":1565940348,"updated":1565940384},{"id":"5d565aa14ade4d00000b305e","text":"\tというシーンで使えることが分かった","created":1565940385,"updated":1565940403},{"id":"5d565afb4ade4d00000b3062","text":"\t子コンポーネントでは `forwardRef` で ref を受け取って `useImperativeHandle` を使って、モーダル開け閉め用の関数を指定する","created":1565940475,"updated":1565940618},{"id":"5d565ace4ade4d00000b305f","text":"\t親コンポーネント側で `useRef` を使って `ref` を作って、子に `ref={ref}` で渡す","created":1565940430,"updated":1565940467},{"id":"5d565af74ade4d00000b3061","text":"\t親コンポーネントで `ref.current` から参照する","created":1565940471,"updated":1565940684},{"id":"5d565bd54ade4d00000b3068","text":"\t\t少しハマったのは、`onClick={ref.current ? ref.current.foo : undefined}` みたいな感じに書くと ref の更新で render が走らないっぽいので `foo` を参照できない","created":1565940694,"updated":1565940768},{"id":"5d565c224ade4d00000b306a","text":"\t\t`onClick={() => ref.current ? ref.current.foo() : undefined}` にするとクリックしたタイミングで評価されるので参照できる","created":1565940771,"updated":1565940825},{"id":"5d5658664ade4d00000b305a","text":"\t具体的なコードは","created":1565939815,"updated":1566373577},{"id":"5d5cf6ca4ade4d00001156ff","text":"\tcode:App.tsx","created":1566373578,"updated":1566373585},{"id":"5d5cf6d14ade4d0000115700","text":"\t interface Handler {","created":1566373586,"updated":1566373624},{"id":"5d5cf6f84ade4d0000115705","text":"\t   foo(): void","created":1566373625,"updated":1566373639},{"id":"5d5cf6f84ade4d0000115706","text":"\t }","created":1566373625,"updated":1566373625},{"id":"5d5cf6f34ade4d0000115704","text":"\t ","created":1566373619,"updated":1566373619},{"id":"5d5cf6f24ade4d0000115703","text":"\t const Child = forwardRef<Handler, Props>(props, ref) => {","created":1566373618,"updated":1566373720},{"id":"5d5cf6ef4ade4d0000115701","text":"\t   const { foo } = useSome()","created":1566373616,"updated":1566373928},{"id":"5d5cf81c4ade4d0000115715","text":"\t   useImperativeHandler(ref, () => {","created":1566373917,"updated":1566373917},{"id":"5d5cf72a4ade4d0000115707","text":"\t     foo: () => foo()","created":1566373674,"updated":1566373682},{"id":"5d5cf7334ade4d0000115708","text":"\t   }))","created":1566373683,"updated":1566373699},{"id":"5d5cf7454ade4d0000115709","text":"\t   return <div>...</div>","created":1566373701,"updated":1566373707},{"id":"5d5cf6f04ade4d0000115702","text":"\t }","created":1566373616,"updated":1566373617},{"id":"5d5cf75a4ade4d000011570a","text":"\t ","created":1566373722,"updated":1566373722},{"id":"5d5cf75a4ade4d000011570b","text":"\t const App: React.FC = () => {","created":1566373722,"updated":1566373749},{"id":"5d5cf7754ade4d000011570c","text":"\t   const childRef = useRef({} as Handler)","created":1566373749,"updated":1566373764},{"id":"5d5cf7934ade4d000011570e","text":"\t   return (","created":1566373780,"updated":1566373871},{"id":"5d5cf7ee4ade4d000011570f","text":"\t   \t<div>","created":1566373871,"updated":1566373874},{"id":"5d5cf7f24ade4d0000115710","text":"\t   \t  <button onClick={() => childRef.current ? childRef.current.foo() : null}>click me</button>","created":1566373874,"updated":1566373895},{"id":"5d5cf7fb4ade4d0000115711","text":"\t   \t  <Child ref={childRef} />","created":1566373883,"updated":1566373897},{"id":"5d5cf7ff4ade4d0000115712","text":"\t   \t</div>","created":1566373887,"updated":1566373888},{"id":"5d5cf8014ade4d0000115713","text":"\t   )","created":1566373890,"updated":1566373892},{"id":"5d5cf7754ade4d000011570d","text":"\t }","created":1566373749,"updated":1566373750},{"id":"5d565c5b4ade4d00000b306b","text":"\tこんな感じ #20190821","created":1565940827,"updated":1566373950},{"id":"5d5cf80d4ade4d0000115714","text":"","created":1566373902,"updated":1566373902},{"id":"5d56583c4ade4d00000b3058","text":"\t参考:","created":1565939773,"updated":1565939773},{"id":"5d5658354ade4d00000b3057","text":"\t\thttps://ja.reactjs.org/docs/hooks-reference.html#useimperativehandle","created":1565939765,"updated":1565939771},{"id":"5d56582d4ade4d00000b3055","text":"\t\thttps://ja.reactjs.org/docs/forwarding-refs.html","created":1565939757,"updated":1565939771},{"id":"5d5658304ade4d00000b3056","text":"\t","created":1565939760,"updated":1565939760},{"id":"5d5541db4ade4d00000b3053","text":"#20190815 #0815","created":1565868508,"updated":1565868510},{"id":"5d5541db4ade4d00000b3054","text":"","created":1565868508,"updated":1565868508}]}