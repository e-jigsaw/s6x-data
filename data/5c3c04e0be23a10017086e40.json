{"id":"5c3c04e0be23a10017086e40","title":"twitter の userstream が突然調子悪くなる案件 - dev.jgs.me","image":null,"created":1386774000,"updated":1576083572,"lines":[{"id":"5c3c04e04ade4d0000c9d93c","text":"twitter の userstream が突然調子悪くなる案件 - dev.jgs.me","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d93e","text":"`node.js` から twitter の userstream を扱うのには、`ntwitter` は挙動がバギーなので `user-stream` を使っている。","created":1386774000,"updated":1576083563},{"id":"5c3c04e04ade4d0000c9d93f","text":"","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d940","text":"[https://github.com/aivis/user-stream https://github.com/aivis/user-stream]","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d941","text":"","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d942","text":"ログを見てみると `garbage` イベントを吐きまくっていた。当該部分を読んでみると","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d943","text":"","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d944","text":"[https://github.com/aivis/user-stream/blob/master/lib/user-stream.js#L131 https://github.com/aivis/user-stream/blob/master/lib/user-stream.js#L131]","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d945","text":"","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d946","text":"code:_","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d947","text":" try {","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d948","text":"     //try parse & emit","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d949","text":"     buffer = JSON.parse(buffer);","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d94a","text":"     parsed = true;","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d94b","text":" } catch(e) {","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d94c","text":"     stream.emit('garbage', buffer);","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d94d","text":" }","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d94e","text":"","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d94f","text":"という感じで、`JSON.parse` に失敗したら `garbage` を吐くようになってる。`catch` 節で `buffer` をダンプしてみると確かにjsonデータがぶつ切れになっていて、そりゃあパースに失敗するよなあ、という感じ。","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d950","text":"","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d951","text":"今は小康状態で時々出るぐらいなんだけど、困ったなー。いっちょフォークして直してやるか！...とおもったら、そういう時に限ってなかなか `garbage` が発火しなくて泣ける。","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d952","text":"","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d953","text":"一旦様子見で。","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d954","text":"","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d955","text":"[* original: http://dev.jgs.me/2013/12/12/tenor-twitter-userstream-suddenly-e-case]","created":1386774000,"updated":1386774000},{"id":"5c3c04e04ade4d0000c9d956","text":"#20131212 #1212","created":1386774000,"updated":1576083572},{"id":"5df120714ade4d00003a7702","text":"","created":1576083570,"updated":1576083570}]}