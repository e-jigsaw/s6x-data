{"id":"67be80f6bbd53d87d39f4ce7","title":"ローカルLLM 2.0","image":null,"created":1740538103,"updated":1740538113,"lines":[{"id":"67be80f6bbd53d87d39f4ce7","text":"ローカルLLM 2.0","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb086","text":"from [20250223] #0223","created":1740538103,"updated":1740538113},{"id":"67be80f44ade4d0000aeb087","text":"ローカルLLM 2.0","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb088","text":"\t[Devin] と遊ぶ機会があり、コレは体験としてヤバい!!!! となったので久々にローカルLLM環境をちゃんと整備する機運が高まった","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb089","text":"\t\tDevin のワークフローとして、指示を出したらしばらくはほっとけばいいので、token/sec はあまり気にしなくてよいのでそういう意味で不用意にエージェントにAPIキーを渡してAI破産するよりは「妙に電気代たけえな？」の方がマシかなと","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb08a","text":"\t[command-r-plus] あたりの時分は、メモリマシマシの [mac] を買うのがいいのかなあ、などと考えていたのだけど https://github.com/exo-explore/exo ていうのがあって、家のあらゆるマシンをクラスタリングできるぞってことで試してみることに","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb08b","text":"\t現代の [Python] は [rye] ってやつで管理するのがモダンらしいので [rye] で最新ぐらいの Python をいれておく","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb08c","text":"\t[venv] ってやつを使うと仮想環境？みたいのを作れるらしいので一応 venv で環境を切っておく","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb08d","text":"\tあとは [exo] の README の通りやると [mac] 複数台のクラスタリングっぽいものは動いてる感じがした","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb08e","text":"\t[Windows] のマシンにはそれなりの [Nvidia] のグラボが刺さってるわけなので、それはさすがに Windows のマシンも参加させたいぞってことで Windows からもプールに参加しようとしたんだけど、これがなかなか沼だった","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb08f","text":"\t\tそもそも exo が Windows のネイティブサポートを諦めていて、[wsl] 経由で使ってな、とのことで wsl の中に環境を作らないといけない","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb090","text":"\t\tで、まず wsl を最新にしとかないといけなかった(1敗)","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb091","text":"\t\t\twsl2 だし問題ないだろ、とおもってたけど自分が前に wsl 触ってた時から大幅にいろいろと変更があったようだ","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb092","text":"\t\twsl の中に [CUDA] やらなんやらのドライバをインストールしてはいけない(2敗)","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb093","text":"\t\t\twsl では Windows 側のドライバを使うようになってるそうで、素朴な [linux] だとおもって CUDA まわりのドライバをいれると so が読めなかったりなんだりで死ぬ","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb094","text":"\t\t開けるポートの問題(3敗)","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb095","text":"\t\t\tコードを読むと(w/ [copilot])、デフォルトでは [UDP] のディスカバリのポートが5678になっているので、5678が開いていればいいのだろう、と Windows の firewall の設定を変更するのだが、Windows のマシンからは mac たちが見えているものの mac から Windows が見えねえになってしまう","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb096","text":"\t\t\t`DEBUG` フラグをつけて、挙動を確認していると、どうやら SingletonDownloader? というものが起動時に適当なポートを選んで何やら通信に使っているらしい","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb097","text":"\t\t\tmac 側のログをみて、どのポートにアクセスしようとしているのか確認して、windows 側で当該ポートを開けると mac からも healthy node として認識されてトポロジーに追加されるようになった","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb098","text":"\t晴れて我が家の持てる力を全て振り絞ったコンピューティングリソースで計算できるようにはなったのだが、薄々勘付いていたコトとして mac のノードでは [MLX] のモデルをダウンロードしていて、wsl のノードでは [Llama] のモデルをダウンロードしていて、コレって相互に補完するようなレイヤーがあったりするのかしら？と一縷の望みをかけて「hello」って送ってみたらぶっ壊れたレスポンスが延々返ってきて終わった","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb099","text":"\t一旦 mac だけのクラスターに戻して、でっかいモデルはど〜よ？と試しに Llama 3.3 70B なるものをロードしてみるとさすがに全然無理だった","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb09a","text":"\t他のクラスタリングソリューションをみてみると、[Ollama] を [k8s] でクラスタリングできる [helm] はあるみたい","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb09b","text":"\t\thttps://github.com/otwld/ollama-helm","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb09c","text":"\t家のサーバは [Proxmox] で管理しているのだけど、[k8s] とまではいかずとも [k3s] か [k0s] の環境を構築してもいいのかもなあ....","created":1740538103,"updated":1740538103},{"id":"67be80f44ade4d0000aeb09d","text":"","created":1740538103,"updated":1740538103}]}