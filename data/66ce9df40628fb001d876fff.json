{"id":"66ce9df40628fb001d876fff","title":"20240828","image":null,"created":1724816888,"updated":1724817548,"lines":[{"id":"66ce9df40628fb001d876fff","text":"20240828","created":1724816888,"updated":1724816888},{"id":"66ce9df74ade4d0000e90fd2","text":"#0828","created":1724816888,"updated":1724816888},{"id":"66ce9df74ade4d0000e90fd3","text":"","created":1724816888,"updated":1724816888},{"id":"66ce9df94ade4d0000e90fd4","text":"[hono] on [Cloudflare Pages] で [Auth.js] + [Resend] で passless 認証","created":1724816889,"updated":1724816934},{"id":"66ce9e164ade4d0000e90fd6","text":"\t元 [next-auth] こと Auth.js はちょっと使ったことあって、[Cloudflare Workers] には [D1] があるので、これをストアとして素直にセッション張れるんじゃ？ということで","created":1724816919,"updated":1724816994},{"id":"66ce9e624ade4d0000e90fd7","text":"\tありがたいことに hono には Auth.js の middleware があって https://www.npmjs.com/package/@hono/auth-js サンプル通りに書いてやって、`providers` に `Resend` の provider を追加して、`adapter` には `DrizzleAdapter` を指定した([drizzle] に慣れているので)","created":1724816994,"updated":1724817137},{"id":"66ce9ef14ade4d0000e90fd8","text":"\t\tdrizzle のスキーマ定義は https://authjs.dev/getting-started/adapters/drizzle に書いてある通りの内容でスキーマを定義してやって、migrate すればよい","created":1724817138,"updated":1724817204},{"id":"66ce9f364ade4d0000e90fd9","text":"\tこんな感じでセットアップして `/api/auth/signin` にアクセスすると、メアドをいれるだけの input と button があるので入力すると Resend からメールが送られてくるので、メールのリンクにアクセスすると callback が飛んでアカウントの作成まで通った","created":1724817206,"updated":1724817305},{"id":"66ce9f9a4ade4d0000e90fda","text":"\t\t環境変数に Resend の API Key をいれておくのを忘れない","created":1724817306,"updated":1724817324},{"id":"66ce9fac4ade4d0000e90fdb","text":"\t\tところで、Resend のことはじめて知ったんだけど便利そうな気配を感じる","created":1724817325,"updated":1724817356},{"id":"66ce9fce4ade4d0000e90fdc","text":"\t今どき [OAuth] の実装とかも面倒だなって気持ちがあり、かといって ID/Pass 認証ってのももうダルいのでいわゆる Magic Link 的なので認証するのが手っ取り早いかな〜と","created":1724817358,"updated":1724817412},{"id":"66cea0054ade4d0000e90fdd","text":"\t\t少し前は [Supabase] を認証に使っていたが、Supabase を採用するとじゃあ DB も Supabase にするかあ、みたいなことになり、いろいろダルくなっていくので [Cloudflare] スタックでまとまるようにした","created":1724817413,"updated":1724817467},{"id":"66cea03c4ade4d0000e90fde","text":"\t\t\tCloudflare にこの手の IdP? の仕組みがあるといいんだけど、[Cloudflare Access] があるだけでこいつはそういう用途には使えなそうなので断念...","created":1724817468,"updated":1724817513},{"id":"66cea0774ade4d0000e90fdf","text":"\t\t\t何気に Resend の部分も Cloudflare の [SES] みたいなのがあるとラクそうだけどなあ...","created":1724817528,"updated":1724817548},{"id":"66ce9df94ade4d0000e90fd5","text":"","created":1724816889,"updated":1724816889}]}