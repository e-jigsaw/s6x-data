{"id":"642121e5a2406b001baa442e","title":"Next.js + Prisma + next-auth","image":null,"created":1679892965,"updated":1679892970,"lines":[{"id":"642121e5a2406b001baa442e","text":"Next.js + Prisma + next-auth","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e3014e","text":"from [20230326] #0326","created":1679892965,"updated":1679892970},{"id":"642121e54ade4d0000e3014f","text":"[Next.js] + [Prisma] + [next-auth]","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e30150","text":"\tnext-auth は [Auth.js] として next 以外の FW でも使えるようにしていく計画らしい","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e30151","text":"\t\t[react-query] も抽象化していったしこういうライブラリ系はマルチFWが基本になってくのかな","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e30152","text":"\tともかく、今のところは next-auth として使う","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e30153","text":"\tPrisma は久しぶりなので思い出しながら...","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e30154","text":"\tDB は [postgresql] をローカルに建てる","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e30155","text":"\tPrisma には https://authjs.dev/reference/adapter/prisma#create-the-prisma-schema-from-scratch にあるスキーマを流し込んでおく","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e30156","text":"\t`prisma migrate dev` でマイグレーション","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e30157","text":"\tnext-auth がいろいろハンドリングしてくれるそうなので `pages/api/auth/[...nextauth].ts` てファイルをつくって、`NextAuth` のインスタンスを渡しておく","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e30158","text":"\tサインインは `next-auth/react` から `signIn` を import して、適当に `onClick` に渡してやるだけでよい","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e30159","text":"\t\tここで少々ハマって、[Proxmox] の [CT] 上で開発してるので `localhost` ではないドメインで動かしていたのだが、なぜかリダイレクト先が `localhost` になってしまう","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e3015a","text":"\t\t\tこれは `NEXT_AUTH_URL` を環境変数として渡してやるとオーバーライドできるようだった","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e3015b","text":"\tユーザの情報を引く時は `SessionProvider` をツリーの高めにいれておいて `useSession` で引いてこれる","created":1679892965,"updated":1679892965},{"id":"642121e54ade4d0000e3015c","text":"","created":1679892965,"updated":1679892965}]}