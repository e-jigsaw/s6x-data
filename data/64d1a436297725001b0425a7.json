{"id":"64d1a436297725001b0425a7","title":"Cloudflare Zero Trust で外から家のサーバにアクセスする","image":null,"created":1691460663,"updated":1691460667,"lines":[{"id":"64d1a436297725001b0425a7","text":"Cloudflare Zero Trust で外から家のサーバにアクセスする","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6d1","text":"from [20230804] #0804","created":1691460663,"updated":1691460667},{"id":"64d1a4374ade4d00004df6d2","text":"[Cloudflare Zero Trust] で外から家のサーバにアクセスする","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6d3","text":"\t[Nebula をみっけた]で [Cloudflare] の Zero Trust の機運を感じたので試してみた","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6d4","text":"\thttps://www.notr.app/posts/2023/01/28/","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6d5","text":"\tが参考になった","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6d6","text":"\t今回は宅の[ルータ]に `cloudflared` をいれて、tunnel を create した","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6d7","text":"\t\t[GitHub] からバイナリをダウンロードした","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6d8","text":"\t\t\t[arm] コアなのはわかってたんだけど、32bit なのか 64bit なのかわからんかったが `uname -m` で64っぽかったので64bitにした","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6d9","text":"\ttunnel を create して yaml の config を用意して立ち上げる","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6da","text":"\t\tPrivate network に宅の [CIDR] を設定","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6db","text":"\t画面の設定が結構散らばってて(高機能だから仕方ないのかもしれんが)わかりにくい","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6dc","text":"\t\tSettings => WARP client から Device の enrollment permission を設定しないとアプリの [WARP] から Zero Trust に入れないので設定しておく","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6dd","text":"\t\t\tとりあえずメアド認証で","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6de","text":"\t\tAccess => Applications から Application を作って Destination IP を指定しておく","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6df","text":"\t\tSettings => WARP client => Device settings => Profile settings => Split tunnels でローカルっぽい IP が Exclude されてしまっているので Include に変更して宅の CIDR を設定しておく","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6e0","text":"\t...というような流れで、外から WARP で [VPN] 接続している状態で家サーバにアクセスできた","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6e1","text":"\tいちいち IP でアクセスするのは面倒なので、なんらか [DNS] をカマしたい","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6e2","text":"\thttps://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/private-hostnames-ips/","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6e3","text":"\tによると Local domain fallback でいけそう","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6e4","text":"\tこれも画面が深くて↑の Profile settings => Local domain fallback から設定する","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6e5","text":"\t\t家に [Pi-hole] が建ってるので、自前ドメインは Pi-hole の IP で解決するってしたら無事にドメインからアクセスできるようになった","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6e6","text":"\t一応まあここら辺までは [Tailscale] でもできてたことなので特にまあって感じではあるが、特定のなんかを一時的にインターネットで受けたい時に tunnel で public にすればいいだけのはずなので、こっちに寄せるでよいかもしれない","created":1691460663,"updated":1691460663},{"id":"64d1a4374ade4d00004df6e7","text":"","created":1691460663,"updated":1691460663}]}